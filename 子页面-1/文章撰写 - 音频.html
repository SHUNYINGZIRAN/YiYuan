<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>非遗文章撰写 - 云间小阁</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Ma+Shan+Zheng&family=Noto+Serif+SC:wght@400;700&display=swap"
        rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Noto Serif SC', serif;
            background-color: #f8f4e9;
            color: #5c4c3e;
            line-height: 1.6;
            background-image:
                radial-gradient(#d6ccc2 1px, transparent 1px),
                radial-gradient(#d6ccc2 1px, transparent 1px);
            background-size: 40px 40px;
            background-position: 0 0, 20px 20px;
            position: relative;
        }

        body::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(248, 244, 233, 0.8);
            z-index: -1;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            text-align: center;
            padding: 30px 0;
            position: relative;
        }

        .header-content {
            max-width: 800px;
            margin: 0 auto;
            position: relative;
        }

        .title {
            font-family: 'Ma Shan Zheng', cursive;
            font-size: 3rem;
            color: #8c3c2c;
            margin-bottom: 15px;
            letter-spacing: 5px;
            text-shadow: 2px 2px 4px rgba(92, 76, 62, 0.2);
        }

        .subtitle {
            font-size: 1.1rem;
            color: #8c6d46;
            margin-bottom: 30px;
            position: relative;
            display: inline-block;
        }

        .subtitle::after {
            content: "";
            position: absolute;
            bottom: -10px;
            left: 50%;
            transform: translateX(-50%);
            width: 120px;
            height: 2px;
            background: linear-gradient(90deg, transparent, #8c3c2c, transparent);
        }

        .divider {
            height: 2px;
            background: linear-gradient(90deg, transparent, #8c6d46, transparent);
            margin: 30px 0;
        }

        .search-section {
            background: rgba(255, 253, 245, 0.9);
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(92, 76, 62, 0.1);
            margin-bottom: 30px;
            border: 1px solid #d6ccc2;
        }

        .search-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .search-title {
            font-family: 'Ma Shan Zheng', cursive;
            font-size: 1.8rem;
            color: #8c3c2c;
        }

        .draft-info {
            font-size: 0.9rem;
            color: #8c6d46;
            background: #f1e9dd;
            padding: 8px 15px;
            border-radius: 20px;
        }

        .search-box {
            position: relative;
            margin-bottom: 20px;
        }

        .search-box input {
            width: 100%;
            padding: 14px 20px 14px 45px;
            border: 1px solid #d6ccc2;
            border-radius: 30px;
            background: rgba(255, 255, 255, 0.7);
            font-family: 'Noto Serif SC', serif;
            font-size: 1rem;
            color: #5c4c3e;
            box-shadow: 0 2px 8px rgba(92, 76, 62, 0.1);
        }

        .search-box i {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: #8c6d46;
        }

        .category-filters {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 20px;
        }

        .filter-btn {
            padding: 8px 16px;
            background: rgba(255, 255, 255, 0.7);
            border: 1px solid #d6ccc2;
            border-radius: 30px;
            color: #5c4c3e;
            font-family: 'Noto Serif SC', serif;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .filter-btn:hover,
        .filter-btn.active {
            background: #8c6d46;
            color: #fff;
        }

        .search-results {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
            max-height: 300px;
            overflow-y: auto;
            padding: 10px;
        }

        .category-item {
            background: #f1e9dd;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #d6ccc2;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .category-item:hover {
            background: #e5d9c8;
            transform: translateY(-3px);
        }

        .category-item.used {
            background: #e8d8d8;
            cursor: not-allowed;
            opacity: 0.7;
        }

        .category-item.selected {
            background: #d8e8d8;
            border-color: #8c6d46;
        }

        .category-name {
            font-weight: bold;
            color: #8c3c2c;
            margin-bottom: 5px;
        }

        .category-status {
            font-size: 0.8rem;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .status-available {
            color: #4c8c4c;
        }

        .status-used {
            color: #8c4c4c;
        }

        .editor-section {
            background: rgba(255, 253, 245, 0.9);
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(92, 76, 62, 0.1);
            margin-bottom: 30px;
            border: 1px solid #d6ccc2;
        }

        .editor-header {
            margin-bottom: 25px;
        }

        .editor-title {
            font-family: 'Ma Shan Zheng', cursive;
            font-size: 1.8rem;
            color: #8c3c2c;
            margin-bottom: 15px;
        }

        .selected-category {
            display: flex;
            align-items: center;
            gap: 10px;
            background: #f1e9dd;
            padding: 10px 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            max-width: fit-content;
        }

        .selected-category span {
            font-weight: bold;
            color: #8c3c2c;
        }

        .change-category {
            color: #8c6d46;
            cursor: pointer;
            font-size: 0.9rem;
            text-decoration: underline;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #5c4c3e;
        }

        .form-control {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid #d6ccc2;
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.7);
            font-family: 'Noto Serif SC', serif;
            font-size: 1rem;
            color: #5c4c3e;
            transition: all 0.3s ease;
        }

        .form-control:focus {
            outline: none;
            border-color: #8c6d46;
            box-shadow: 0 0 0 2px rgba(140, 109, 70, 0.2);
        }

        textarea.form-control {
            min-height: 200px;
            resize: vertical;
        }

        .editor-actions {
            display: flex;
            justify-content: flex-end;
            gap: 15px;
            margin-top: 30px;
        }

        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            font-family: 'Noto Serif SC', serif;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-outline {
            background: transparent;
            border: 1px solid #8c6d46;
            color: #8c6d46;
        }

        .btn-outline:hover {
            background: #f1e9dd;
        }

        .btn-primary {
            background: #8c6d46;
            color: #fff;
        }

        .btn-primary:hover {
            background: #745b3a;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(92, 76, 62, 0.25);
        }

        .btn-primary:disabled {
            background: #cccccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        /* 自定义文件上传样式 */
        .upload-label-info {
            pointer-events: none;
            /* 确保标签没有操作性 */
            user-select: none;
            /* 防止文本被选中 */
            cursor: default;
            /* 默认光标 */
        }

        .custom-file-upload {
            position: relative;
            width: 100%;
        }

        .custom-file-upload input[type="file"] {
            position: absolute;
            width: 0;
            height: 0;
            opacity: 0;
            cursor: pointer;
            z-index: -1;
        }

        .file-upload-box {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 30px;
            border: 2px dashed #d6ccc2;
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.5);
            transition: all 0.3s ease;
            text-align: center;
        }

        .custom-file-upload:hover .file-upload-box {
            border-color: #8c6d46;
            background: rgba(241, 233, 221, 0.5);
        }

        .file-upload-box i {
            font-size: 2.5rem;
            color: #8c6d46;
            margin-bottom: 15px;
        }

        .upload-text {
            font-family: 'Ma Shan Zheng', cursive;
            font-size: 1.3rem;
            color: #8c3c2c;
            margin-bottom: 10px;
        }

        .upload-hint {
            font-size: 0.9rem;
            color: #8c6d46;
        }

        .file-preview-container,
        .video-preview-container,
        .audio-preview-container {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-top: 20px;
            position: relative;
            z-index: 3;
            /* 确保预览区域在文件上传区域之上 */
        }

        .file-preview,
        .video-preview {
            position: relative;
            width: 100px;
            height: 100px;
            border-radius: 8px;
            overflow: hidden;
            border: 1px solid #d6ccc2;
            box-shadow: 0 2px 8px rgba(92, 76, 62, 0.1);
        }

        .audio-preview {
            position: relative;
            width: 100%;
            height: 60px;
            border-radius: 8px;
            overflow: hidden;
            border: 1px solid #d6ccc2;
            box-shadow: 0 2px 8px rgba(92, 76, 62, 0.1);
            background-color: #f1e9dd;
            display: flex;
            align-items: center;
            padding: 0 15px;
        }

        .file-preview img,
        .video-preview video {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .audio-preview audio {
            width: 100%;
            height: 40px;
        }

        .file-preview .remove-file,
        .video-preview .remove-file,
        .audio-preview .remove-file {
            position: absolute;
            top: 5px;
            right: 5px;
            width: 20px;
            height: 20px;
            background: rgba(140, 60, 44, 0.8);
            color: #fff;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 0.8rem;
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: 8px;
            background: #f8f4e9;
            border: 1px solid #d6ccc2;
            box-shadow: 0 4px 15px rgba(92, 76, 62, 0.2);
            transform: translateX(100%);
            transition: transform 0.3s ease;
            z-index: 1000;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification.success {
            border-left: 4px solid #4c8c4c;
        }

        .notification.error {
            border-left: 4px solid #8c4c4c;
        }

        footer {
            text-align: center;
            padding: 40px 0 20px;
            margin-top: 50px;
            color: #8c6d46;
            font-size: 0.9rem;
        }

        @media (max-width: 768px) {
            .title {
                font-size: 2.2rem;
            }

            .search-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }

            .editor-actions {
                flex-direction: column;
            }

            .btn {
                width: 100%;
            }
        }

        .decoration {
            position: absolute;
            opacity: 0.1;
            z-index: -1;
            font-family: 'Ma Shan Zheng', cursive;
            color: #8c3c2c;
        }

        .decoration-1 {
            top: 50px;
            left: 5%;
            font-size: 6rem;
            transform: rotate(-10deg);
        }

        .decoration-2 {
            bottom: 100px;
            right: 5%;
            font-size: 5rem;
            transform: rotate(15deg);
        }
    </style>
</head>

<body>
    <div class="decoration decoration-1">文</div>
    <div class="decoration decoration-2">遗</div>

    <div class="container">
        <header>
            <div class="header-content">
                <h1 class="title">非遗文章撰写</h1>
                <p class="subtitle">传承文化精髓，记录非遗瑰宝</p>
            </div>
        </header>

        <div class="divider"></div>

        <div class="search-section">
            <div class="search-header">
                <h2 class="search-title">选择非遗类目</h2>
                <div class="draft-info">
                    <i class="fas fa-info-circle"></i> 每种非遗只能撰写一篇文章
                </div>
            </div>

            <div class="search-box">
                <i class="fas fa-search"></i>
                <input type="text" id="categorySearch" placeholder="搜索非遗类目...">
            </div>

            <div class="category-filters">
                <button class="filter-btn active">全部</button>
                <button class="filter-btn">传统技艺</button>
                <button class="filter-btn">表演艺术</button>
                <button class="filter-btn">民俗活动</button>
                <button class="filter-btn">传统医药</button>
                <button class="filter-btn">口头传统</button>
            </div>

            <div class="search-results" id="categoryResults">
                <!-- 分类项目将通过JavaScript动态生成 -->
            </div>
        </div>

        <div class="editor-section" id="editorSection" style="display: none;">
            <div class="editor-header">
                <h2 class="editor-title">撰写文章</h2>
                <div class="selected-category">
                    <span>已选类目：</span>
                    <div id="selectedCategoryName">暂无选择</div>
                    <div class="change-category" id="changeCategory">更改类目</div>
                </div>
            </div>

            <div class="form-group">
                <label for="articleTitle">文章标题</label>
                <input type="text" id="articleTitle" class="form-control" placeholder="请输入文章标题">
            </div>

            <div class="form-group">
                <label for="articleContent">文章内容</label>
                <textarea id="articleContent" class="form-control" placeholder="请输入文章内容..."></textarea>
            </div>

            <div class="form-group">
                <label for="articleImages" class="upload-label-info">上传图片（可选）</label>
                <div class="custom-file-upload">
                    <input type="file" id="articleImages" multiple accept="image/*">
                    <div class="file-upload-box">
                        <i class="fas fa-cloud-upload-alt"></i>
                        <span class="upload-text">点击或拖拽图片至此处</span>
                        <span class="upload-hint">支持JPG、PNG格式</span>
                    </div>
                    <div class="file-preview-container"></div>
                </div>
            </div>

            <div class="form-group">
                <label for="articleVideo" class="upload-label-info">上传视频（可选）</label>
                <div class="custom-file-upload">
                    <input type="file" id="articleVideo" accept="video/*">
                    <div class="file-upload-box">
                        <i class="fas fa-cloud-upload-alt"></i>
                        <span class="upload-text">点击或拖拽视频至此处</span>
                        <span class="upload-hint">支持MP4、MOV格式，仅限1个</span>
                    </div>
                    <div class="video-preview-container"></div>
                </div>
            </div>

            <div class="form-group">
                <label for="articleAudio" class="upload-label-info">上传音频（可选）</label>
                <div class="custom-file-upload">
                    <input type="file" id="articleAudio" accept="audio/*">
                    <div class="file-upload-box">
                        <i class="fas fa-cloud-upload-alt"></i>
                        <span class="upload-text">点击或拖拽音频至此处</span>
                        <span class="upload-hint">支持MP3、WAV格式，仅限1个</span>
                    </div>
                    <div class="audio-preview-container"></div>
                </div>
            </div>

            <div class="editor-actions">
                <button class="btn btn-outline" id="saveDraft">保存草稿</button>
                <button class="btn btn-primary" id="submitArticle" disabled>提交审核</button>
            </div>
        </div>

        <footer style="border-top: 1px solid #d6ccc2;">
            <p>© 2023 云间小阁 | 传承文化，记录非遗</p>
        </footer>
    </div>

    <div class="notification" id="notification">
        <i class="fas fa-check-circle"></i>
        <div id="notificationText">操作成功</div>
    </div>

    <script>
        // 模拟非遗类目数据
        const intangibleCulturalHeritages = [
            { id: 1, name: "京剧", category: "表演艺术", used: true, usedBy: "其他用户" },
            { id: 2, name: "剪纸", category: "传统技艺", used: false },
            { id: 3, name: "端午节", category: "民俗活动", used: false },
            { id: 4, name: "中医针灸", category: "传统医药", used: true, usedBy: "其他用户" },
            { id: 5, name: "皮影戏", category: "表演艺术", used: false },
            { id: 6, name: "龙泉青瓷", category: "传统技艺", used: false },
            { id: 7, name: "妈祖信俗", category: "民俗活动", used: true, usedBy: "当前用户" },
            { id: 8, name: "珠算", category: "传统技艺", used: false },
            { id: 9, name: "二十四节气", category: "民俗活动", used: false },
            { id: 10, name: "书法", category: "传统技艺", used: true, usedBy: "其他用户" },
            { id: 11, name: "古琴艺术", category: "表演艺术", used: false },
            { id: 12, name: "端午节", category: "民俗活动", used: false },
            { id: 13, name: "中国篆刻", category: "传统技艺", used: false },
            { id: 14, name: "蒙古族长调民歌", category: "口头传统", used: true, usedBy: "其他用户" },
            { id: 15, name: "侗族大歌", category: "表演艺术", used: false }
        ];

        document.addEventListener('DOMContentLoaded', function () {
            const categorySearch = document.getElementById('categorySearch');
            const categoryResults = document.getElementById('categoryResults');
            const editorSection = document.getElementById('editorSection');
            const selectedCategoryName = document.getElementById('selectedCategoryName');
            const changeCategoryBtn = document.getElementById('changeCategory');
            const articleTitle = document.getElementById('articleTitle');
            const articleContent = document.getElementById('articleContent');
            const saveDraftBtn = document.getElementById('saveDraft');
            const submitArticleBtn = document.getElementById('submitArticle');
            const notification = document.getElementById('notification');
            const notificationText = document.getElementById('notificationText');
            const filterBtns = document.querySelectorAll('.filter-btn');

            let selectedCategory = null;
            let currentFilter = '全部';

            // 初始化显示所有非遗类目
            renderCategories(intangibleCulturalHeritages);

            // 搜索功能
            categorySearch.addEventListener('input', function () {
                const searchTerm = this.value.toLowerCase();
                const filteredCategories = intangibleCulturalHeritages.filter(category => {
                    return category.name.toLowerCase().includes(searchTerm) &&
                        (currentFilter === '全部' || category.category === currentFilter);
                });
                renderCategories(filteredCategories);
            });

            // 筛选功能
            filterBtns.forEach(btn => {
                btn.addEventListener('click', function () {
                    filterBtns.forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    currentFilter = this.textContent;

                    const searchTerm = categorySearch.value.toLowerCase();
                    const filteredCategories = intangibleCulturalHeritages.filter(category => {
                        return category.name.toLowerCase().includes(searchTerm) &&
                            (currentFilter === '全部' || category.category === currentFilter);
                    });
                    renderCategories(filteredCategories);
                });
            });

            // 更改类目按钮
            changeCategoryBtn.addEventListener('click', function () {
                editorSection.style.display = 'none';
                selectedCategory = null;
                selectedCategoryName.textContent = '暂无选择';
            });

            // 文章标题和内容输入验证
            articleTitle.addEventListener('input', validateForm);
            articleContent.addEventListener('input', validateForm);

            // 文件上传处理
            const articleImages = document.getElementById('articleImages');
            const articleVideo = document.getElementById('articleVideo');
            const articleAudio = document.getElementById('articleAudio');
            const filePreviewContainer = document.querySelector('.file-preview-container');
            const videoPreviewContainer = document.querySelector('.video-preview-container');
            const audioPreviewContainer = document.querySelector('.audio-preview-container');
            const fileUploadBox = document.querySelector('.file-upload-box');
            const videoUploadBox = document.querySelectorAll('.file-upload-box')[1];
            const audioUploadBox = document.querySelectorAll('.file-upload-box')[2];

            // 点击上传区域触发文件选择
            fileUploadBox.addEventListener('click', function (e) {
                // 确保点击事件仅来自file-upload-box容器本身或其直接子元素
                if (e.target === this ||
                    e.target === this.querySelector('i') ||
                    e.target === this.querySelector('.upload-text') ||
                    e.target === this.querySelector('.upload-hint')) {
                    articleImages.click();
                }
            });

            // 点击视频上传区域触发文件选择
            videoUploadBox.addEventListener('click', function (e) {
                // 确保点击事件仅来自file-upload-box容器本身或其直接子元素
                if (e.target === this ||
                    e.target === this.querySelector('i') ||
                    e.target === this.querySelector('.upload-text') ||
                    e.target === this.querySelector('.upload-hint')) {
                    // 检查是否已有视频
                    if (videoPreviewContainer.querySelector('.video-preview')) {
                        showNotification('只能上传一个视频，请先删除当前视频', 'error');
                        return;
                    }
                    articleVideo.click();
                }
            });
            
            // 点击音频上传区域触发文件选择
            audioUploadBox.addEventListener('click', function (e) {
                // 确保点击事件仅来自file-upload-box容器本身或其直接子元素
                if (e.target === this ||
                    e.target === this.querySelector('i') ||
                    e.target === this.querySelector('.upload-text') ||
                    e.target === this.querySelector('.upload-hint')) {
                    // 检查是否已有音频
                    if (audioPreviewContainer.querySelector('.audio-preview')) {
                        showNotification('只能上传一个音频，请先删除当前音频', 'error');
                        return;
                    }
                    articleAudio.click();
                }
            });

            articleImages.addEventListener('change', function (e) {
                handleFileUpload(e.target.files);
            });

            articleVideo.addEventListener('change', function (e) {
                handleVideoUpload(e.target.files[0]);
            });
            
            articleAudio.addEventListener('change', function (e) {
                handleAudioUpload(e.target.files[0]);
            });

            // 拖拽上传功能
            fileUploadBox.addEventListener('dragover', function (e) {
                e.preventDefault();
                this.style.borderColor = '#8c3c2c';
                this.style.background = 'rgba(241, 233, 221, 0.8)';
            });

            fileUploadBox.addEventListener('dragleave', function (e) {
                e.preventDefault();
                this.style.borderColor = '#d6ccc2';
                this.style.background = 'rgba(255, 255, 255, 0.5)';
            });

            fileUploadBox.addEventListener('drop', function (e) {
                e.preventDefault();
                this.style.borderColor = '#d6ccc2';
                this.style.background = 'rgba(255, 255, 255, 0.5)';

                if (e.dataTransfer.files.length > 0) {
                    handleFileUpload(e.dataTransfer.files);
                }
            });

            // 视频拖拽上传功能
            videoUploadBox.addEventListener('dragover', function (e) {
                e.preventDefault();
                this.style.borderColor = '#8c3c2c';
                this.style.background = 'rgba(241, 233, 221, 0.8)';
            });

            videoUploadBox.addEventListener('dragleave', function (e) {
                e.preventDefault();
                this.style.borderColor = '#d6ccc2';
                this.style.background = 'rgba(255, 255, 255, 0.5)';
            });
            
            // 音频拖拽上传功能
            audioUploadBox.addEventListener('dragover', function (e) {
                e.preventDefault();
                this.style.borderColor = '#8c3c2c';
                this.style.background = 'rgba(241, 233, 221, 0.8)';
            });

            audioUploadBox.addEventListener('dragleave', function (e) {
                e.preventDefault();
                this.style.borderColor = '#d6ccc2';
                this.style.background = 'rgba(255, 255, 255, 0.5)';
            });

            videoUploadBox.addEventListener('drop', function (e) {
                e.preventDefault();
                this.style.borderColor = '#d6ccc2';
                this.style.background = 'rgba(255, 255, 255, 0.5)';

                if (e.dataTransfer.files.length > 0) {
                    // 检查是否已有视频
                    if (videoPreviewContainer.querySelector('.video-preview')) {
                        showNotification('只能上传一个视频，请先删除当前视频', 'error');
                        return;
                    }
                    handleVideoUpload(e.dataTransfer.files[0]);
                }
            });
            
            audioUploadBox.addEventListener('drop', function (e) {
                e.preventDefault();
                this.style.borderColor = '#d6ccc2';
                this.style.background = 'rgba(255, 255, 255, 0.5)';

                if (e.dataTransfer.files.length > 0) {
                    // 检查是否已有音频
                    if (audioPreviewContainer.querySelector('.audio-preview')) {
                        showNotification('只能上传一个音频，请先删除当前音频', 'error');
                        return;
                    }
                    handleAudioUpload(e.dataTransfer.files[0]);
                }
            });

            function handleFileUpload(files) {
                // 处理文件预览
                for (let i = 0; i < files.length; i++) {
                    const file = files[i];

                    // 检查文件类型
                    if (!file.type.match('image/jpeg') && !file.type.match('image/png')) {
                        showNotification('只支持JPG和PNG格式的图片', 'error');
                        continue;
                    }

                    const reader = new FileReader();
                    reader.onload = function (e) {
                        const preview = document.createElement('div');
                        preview.className = 'file-preview';
                        preview.innerHTML = `
                            <img src="${e.target.result}" alt="预览图片">
                            <div class="remove-file"><i class="fas fa-times"></i></div>
                        `;

                        // 添加删除功能
                        preview.querySelector('.remove-file').addEventListener('click', function (e) {
                            e.stopPropagation(); // 阻止事件冒泡，防止触发上传区域的点击事件
                            preview.remove();
                        });

                        filePreviewContainer.appendChild(preview);
                    };
                    reader.readAsDataURL(file);
                }

            }

            function handleVideoUpload(file) {
                // 检查文件类型
                if (!file.type.match('video/mp4') && !file.type.match('video/quicktime')) {
                    showNotification('只支持MP4和MOV格式的视频', 'error');
                    return;
                }

                const videoURL = URL.createObjectURL(file);
                const preview = document.createElement('div');
                preview.className = 'video-preview';
                preview.innerHTML = `
                    <video src="${videoURL}" controls></video>
                    <div class="remove-file"><i class="fas fa-times"></i></div>
                `;

                // 添加删除功能
                preview.querySelector('.remove-file').addEventListener('click', function (e) {
                    e.stopPropagation(); // 阻止事件冒泡，防止触发上传区域的点击事件
                    preview.remove();
                });

                // 清空已有视频
                videoPreviewContainer.innerHTML = '';
                videoPreviewContainer.appendChild(preview);
            }
            
            function handleAudioUpload(file) {
                // 检查文件类型
                if (!file.type.match('audio/mpeg') && !file.type.match('audio/wav')) {
                    showNotification('只支持MP3和WAV格式的音频', 'error');
                    return;
                }

                const audioURL = URL.createObjectURL(file);
                const preview = document.createElement('div');
                preview.className = 'audio-preview';
                preview.innerHTML = `
                    <audio src="${audioURL}" controls></audio>
                    <div class="remove-file"><i class="fas fa-times"></i></div>
                `;

                // 添加删除功能
                preview.querySelector('.remove-file').addEventListener('click', function (e) {
                    e.stopPropagation(); // 阻止事件冒泡，防止触发上传区域的点击事件
                    preview.remove();
                });

                // 清空已有音频
                audioPreviewContainer.innerHTML = '';
                audioPreviewContainer.appendChild(preview);
            }

            // 保存草稿
            saveDraftBtn.addEventListener('click', function () {
                showNotification('草稿保存成功', 'success');
            });

            // 提交审核
            submitArticleBtn.addEventListener('click', function () {
                // 模拟提交成功
                showNotification('文章已提交审核', 'success');

                // 重置表单
                setTimeout(() => {
                    articleTitle.value = '';
                    articleContent.value = '';
                    editorSection.style.display = 'none';
                    selectedCategory = null;
                    selectedCategoryName.textContent = '暂无选择';
                    submitArticleBtn.disabled = true;

                    // 标记该类目为已使用
                    const categoryIndex = intangibleCulturalHeritages.findIndex(c => c.id === selectedCategory.id);
                    if (categoryIndex !== -1) {
                        intangibleCulturalHeritages[categoryIndex].used = true;
                        intangibleCulturalHeritages[categoryIndex].usedBy = "当前用户";
                    }

                    // 重新渲染类目
                    renderCategories(intangibleCulturalHeritages);
                }, 1500);
            });

            // 渲染类目列表
            function renderCategories(categories) {
                categoryResults.innerHTML = '';

                if (categories.length === 0) {
                    categoryResults.innerHTML = '<div class="no-results">未找到相关非遗类目</div>';
                    return;
                }

                categories.forEach(category => {
                    const categoryItem = document.createElement('div');
                    categoryItem.className = 'category-item';

                    if (category.used) {
                        categoryItem.classList.add('used');
                    }

                    if (selectedCategory && selectedCategory.id === category.id) {
                        categoryItem.classList.add('selected');
                    }

                    const categoryName = document.createElement('div');
                    categoryName.className = 'category-name';
                    categoryName.textContent = category.name;

                    const categoryMeta = document.createElement('div');
                    categoryMeta.className = 'category-meta';
                    categoryMeta.innerHTML = `
                        <span>${category.category}</span>
                    `;

                    const categoryStatus = document.createElement('div');
                    categoryStatus.className = 'category-status';

                    if (category.used) {
                        categoryStatus.innerHTML = `
                            <i class="fas fa-lock"></i>
                            <span class="status-used">已被${category.usedBy}使用</span>
                        `;
                    } else {
                        categoryStatus.innerHTML = `
                            <i class="fas fa-check-circle"></i>
                            <span class="status-available">可用</span>
                        `;
                    }

                    categoryItem.appendChild(categoryName);
                    categoryItem.appendChild(categoryMeta);
                    categoryItem.appendChild(categoryStatus);

                    if (!category.used || category.usedBy === "当前用户") {
                        categoryItem.addEventListener('click', function () {
                            if (category.used && category.usedBy === "当前用户") {
                                // 已由当前用户使用的类目，可以编辑
                                selectCategory(category);
                            } else if (!category.used) {
                                // 未使用的类目，可以选择
                                selectCategory(category);
                            }
                        });
                    }

                    categoryResults.appendChild(categoryItem);
                });
            }

            // 选择类目
            function selectCategory(category) {
                selectedCategory = category;
                selectedCategoryName.textContent = category.name;
                editorSection.style.display = 'block';

                // 滚动到编辑区域
                editorSection.scrollIntoView({ behavior: 'smooth' });

                // 重新渲染类目列表以更新选中状态
                const searchTerm = categorySearch.value.toLowerCase();
                const filteredCategories = intangibleCulturalHeritages.filter(cat => {
                    return cat.name.toLowerCase().includes(searchTerm) &&
                        (currentFilter === '全部' || cat.category === currentFilter);
                });
                renderCategories(filteredCategories);
            }

            // 验证表单
            function validateForm() {
                const titleValid = articleTitle.value.trim().length > 0;
                const contentValid = articleContent.value.trim().length > 0;

                submitArticleBtn.disabled = !(titleValid && contentValid && selectedCategory);
            }

            // 显示通知
            function showNotification(message, type) {
                notificationText.textContent = message;
                notification.className = `notification ${type}`;
                notification.classList.add('show');

                setTimeout(() => {
                    notification.classList.remove('show');
                }, 3000);
            }
        });
    </script>
</body>

</html>